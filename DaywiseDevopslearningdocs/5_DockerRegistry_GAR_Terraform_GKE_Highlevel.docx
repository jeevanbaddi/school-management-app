STEP-5: Docker Registry (GCP Artifact Registry) â†’ Terraform â†’ GKE (High-level first)

Before writing any code, you must understand the flow.
A senior DevOps engineer never jumps directly into Terraform.

ğŸ”‘ BIG PICTURE (MUST KNOW)

Right now your flow is:

GitHub
  â†“
Jenkins
  â†“
Pytest
  â†“
Docker image (local only)


Whatâ€™s missing?

ğŸ‘‰ Your Docker image is stuck inside Jenkins machine
ğŸ‘‰ Kubernetes (GKE) cannot pull it

So we need:

Jenkins
  â†“
Build Docker image
  â†“
Push image to Registry (GCP)
  â†“
Terraform creates infra
  â†“
GKE pulls image & runs app

1ï¸âƒ£ Why Do We Need a Docker Registry?
ğŸ”‘ MUST KNOW (Interview level)

A Docker registry is a centralized place to store and version container images so that deployment platforms like Kubernetes can pull them.

Without a registry:

Jenkins builds image âŒ

GKE cannot access it âŒ

With a registry:

Jenkins pushes image âœ…

GKE pulls image âœ…

Registry Options in GCP
Option	Use
Artifact Registry	âœ… Recommended (modern)
Container Registry (GCR)	Old (deprecated gradually)

ğŸ‘‰ We will use Artifact Registry.

2ï¸âƒ£ What Jenkins Will Do Differently (IMPORTANT)
Current Jenkins stage:
docker build -t school-app:ci .

Updated Jenkins stages (conceptually):
docker build
docker tag
docker push to Artifact Registry


ğŸ”‘ Jenkins is responsible for CI + image publishing
ğŸ”‘ Terraform is responsible for infrastructure only

3ï¸âƒ£ Terraform Role (CLEAR SEPARATION)

This is a senior-level concept ğŸ‘‡

ğŸ”‘ MUST KNOW
Tool	Responsibility
Jenkins	Build & push artifacts
Docker	Package application
Terraform	Create infra (GKE, Registry)
Kubernetes	Run containers

ğŸš« Terraform should NOT:

Build images

Run tests

Push code

4ï¸âƒ£ What Infrastructure We Will Create Using Terraform
Minimal infra for this project:

1ï¸âƒ£ Artifact Registry (Docker repo)
2ï¸âƒ£ GKE cluster (1 small node)
3ï¸âƒ£ (Later) Cloud SQL (optional)

All low-cost, covered by your GCP credits.

5ï¸âƒ£ Before Terraform â€“ One Mandatory Check

You must already have:

gcloud auth list
gcloud config list


Expected:

Your GCP account is active

Correct project selected

If needed:

gcloud config set project <your-project-id>


ğŸ”‘ Terraform uses gcloud credentials under the hood

6ï¸âƒ£ What We Will Do NEXT (Step-by-Step Plan)

We will NOT do everything at once.

Step-5A (Next)

âœ… Create Artifact Registry (manual first)
âœ… Push Docker image from Jenkins to GCP

Step-5B

âœ… Introduce Terraform
âœ… Convert manual infra â†’ Terraform code

Step-5C

âœ… Create GKE cluster via Terraform

Step-5D

âœ… Deploy app to GKE

7ï¸âƒ£ Why We Do Manual First (VERY IMPORTANT)
ğŸ”‘ MUST KNOW (Senior mindset)

â€œNever automate something you donâ€™t understand manually.â€

So:

First â†’ create registry manually

Understand permissions & auth

Then â†’ automate with Terraform

This avoids:
âŒ Blind copy-paste Terraform
âŒ Debugging infra you donâ€™t understand